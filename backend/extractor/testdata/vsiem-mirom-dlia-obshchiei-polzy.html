<!doctype html><html lang=ru-ru><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.73.0"><title>Всем миром для общей пользы • Umputun тут был</title><meta name=description content="заметки на разные темы"><meta name=keywords content="Umputun,Умпутун,blog umputun,блог умпутуна"><meta name=twitter:card content="summary"><meta name=twitter:title content="Всем миром для общей пользы"><meta name=twitter:description content="Не первый раз я практикую идею &ldquo;а давайте, ребята, сделаем для общего блага &mldr;&rdquo;, и вот опять. В нашем подкасте радио-т есть незаменимый инструмент, позволяющий собирать новости, готовить их к выпуску, показывать что активно в данный момент, обновлять чат и всякое прочее."><meta property="og:title" content="Всем миром для общей пользы"><meta property="og:description" content="Не первый раз я практикую идею &ldquo;а давайте, ребята, сделаем для общего блага &mldr;&rdquo;, и вот опять. В нашем подкасте радио-т есть незаменимый инструмент, позволяющий собирать новости, готовить их к выпуску, показывать что активно в данный момент, обновлять чат и всякое прочее."><meta property="og:type" content="article"><meta property="og:url" content="https://p.umputun.com/2015/11/26/vsiem-mirom-dlia-obshchiei-polzy/"><meta property="article:published_time" content="2015-11-26T14:20:40-05:00"><meta property="article:modified_time" content="2015-11-26T14:20:40-05:00"><link rel=stylesheet href=/scss/hyde-hyde.1dba6d534ce47c2a4cbc763f802c07d253479508b81d36993be55eda31531297.css integrity="sha256-HbptU0zkfCpMvHY/gCwH0lNHlQi4HTaZO+Ve2jFTEpc="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-00><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://p.umputun.com/>Umputun тут был</a></span><div class=author-image><img src="https://www.gravatar.com/avatar/95ab21d5dda9d5cbb69e19cc3553d4c3?s=240&d=mp" class="img--circle img--headshot element--center" alt=gravatar></div><p class=site__description>заметки на разные темы</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Umputun тут был</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/><span>Домой</span></a></li><li><a href=https://podcast.umputun.com/><span>Еженедельный Подкаст От Umputun</span></a></li><li><a href=https://radio-t.com/><span>Подкаст Радио-Т</span></a></li><li><a href="https://www.patreon.com/user?u=2577215"><span>Помочь На Patreon</span></a></li></ul></div><section class=social><a href=https://twitter.com/umputun rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a><a href=https://github.com/umputun rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://t.me/umputun rel=me><i class="fab fa-telegram fa-lg" aria-hidden=true></i></a><a href=mailto:umputun@gmail.com rel=me><i class="fas fa-at fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2022 umputun
<a href=https://creativecommons.org/licenses/by-sa/4.0/deed.ru>CC BY-SA 4.0</a></div></div></div><div class="content container"><article><header><h1>Всем миром для общей пользы</h1><div class=post__meta><div class=post__meta-tag><i class="fas fa-calendar-alt"></i>&nbsp;2015-26-11</div><div class=post__meta-tag><i class="fas fa-clock"></i>&nbsp;5 мин.</div><div class=post__meta-tag><i class="fas fa-tags"></i><a class="badge badge-tag" href=/tags/%D0%B4%D0%BB%D1%8F-%D0%B3%D0%B8%D0%BA%D0%BE%D0%B2>&nbsp;для гиков</a>
<a class="badge badge-tag" href=/tags/%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%81%D1%82%D1%8B>&nbsp;подкасты</a></div></div></header><div class=post><p>Не первый раз я практикую идею &ldquo;а давайте, ребята, сделаем для общего блага &mldr;&rdquo;, и вот опять. В нашем подкасте <a href=http://www.radio-t.com>радио-т</a> есть незаменимый инструмент, позволяющий собирать новости, готовить их к выпуску, показывать что активно в данный момент, обновлять чат и всякое прочее. Он действительно незаменим, и я не представляю, как бы мы справлялись без него.</p><p>Этот замечательный <a href=http://news.radio-t.com>news.radio-t.com</a> несколько лет назад был написан одним из наших слушателей (Alex T, @Sqrt) и долго служил нам верой и правдой. Однако, время идет, все развивается. Да и сопровождать этот сервис стало непросто, по ряду причин. Короче говоря, я решил все переделать и уже половину переделал.</p><p>Из монолитного PHP приложения с MYSQL, я хочу поменять это хозяйство на сервис(ы) бэкенда, собирающие новости и отдающими наружу рестообразный API. Там все не совсем чтоб просто, но на практике я написал весь этот бэкенд за день и у него есть вполне достаточный, как минимум для начала, API. И да, я его написал на Go :)</p><p>Теперь дело за второй частью - сделать к этому UI/фронтенд. Это совсем не моя область, и <a href=http://master.radio-t.com:8778>мой фронтенд</a> конечно крут, но &mldr; несколько примитивен ;) Вот я и призываю тех, кто на этом деле собаку съел - приходите, помогите в нашем общем деле. Ниже я опубликовал API и экраны того, как оно сейчас. Эти экраны только для того, чтоб наметить необходимую функциональность, это <strong>не руководство к дизайну</strong> ни разу. Дерзайте, делайте красиво и удобно.</p><p>Да, и вот еще что - я бы хотел, чтоб клиентская сторона не была дикой, и была бы именно клиентской. В том смысле, что если вам хочется прикрутить туда какой nodejs, чтоб поверх API был более другой сервер, то эту идею я не поддержу. Что касается &ldquo;дикости&rdquo; - наверное не стоит это писать на какой-то экзотике, типа фреймворка который знают и умеет два с половиной человека. Этот продукт должен быть сопровождаем не только автором и я предполагаю не один год его жизни у нас в подкасте.</p><p>По поводу возможного <em>&ldquo;а зачем я буду тратить на это свое время?"</em> у меня только один ответ - если не ты, то кто? Ну и, конечно, автор(ы) будут публично похвалены и оглажены в подкасте.</p><h4 id=api>API</h4><pre><code>GET /api/v1/feeds - список фидов
POST /api/v1/feeds - добавить фид {feedlink: url}
DELETE /api/v1/feeds/:id - удалить фид

GET /api/v1/news - все новости, кроме удаленных
GET /api/v1/news/del - удалённые новости
DELETE /api/v1/news/:id - удалить (пометить как удаленную)
PUT /api/v1/news/undelete/:id - восстановить удаленную
PUT /api/v1/news/move/:pos/:offset - двигать новость вверх/вниз

PUT /api/v1/news/active/:id - пометить как активную
GET /api/v1/news/active - взять текущую активную
GET /api/v1/news/active/id - взять id текущей активной
GET /api/v1/news/active/last/:hrs - список всех что были активны за последние hrs часов

PUT /api/v1/news/nogeek/:id - пометить как обычную, негиковскую 
PUT /api/v1/news/geek/:id - пометить как гиковскую

POST /api/v1/news - добавить новость по ссылке, {link: url}

PUT /api/v1/news/reload - форс-релоад из фидов (раз в 5 минут делает само)
</code></pre><p><em>upd: все запросы на PUT/POST/DELETE теперь просят basic auth, test:test</em></p><p>пример:</p><pre><code>http GET master.radio-t.com:8778/api/v1/news/active/id
HTTP/1.1 200 OK
Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With
Access-Control-Allow-Methods: GET, PUT, POST, DELETE, OPTIONS
Access-Control-Allow-Origin: *
Application-Name: rt-news
Connection: keep-alive
Content-Length: 33
Content-Type: application/json
Date: Thu, 26 Nov 2015 22:47:17 GMT
Org: Radio-T
Server: nginx/1.9.7
X-Powered-By: go-json-rest

{
    &quot;id&quot;: &quot;5657741292d7e8a4ace10c5a&quot;
}
</code></pre><p>и еще один:</p><pre><code>http GET master.radio-t.com:8778/api/v1/news/active

HTTP/1.1 200 OK
Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With
Access-Control-Allow-Methods: GET, PUT, POST, DELETE, OPTIONS
Access-Control-Allow-Origin: *
Application-Name: rt-news
Connection: keep-alive
Content-Length: 676
Content-Type: application/json
Date: Thu, 26 Nov 2015 22:49:01 GMT
Org: Radio-T
Server: nginx/1.9.7
X-Powered-By: go-json-rest

{
    &quot;active&quot;: true,
    &quot;activets&quot;: &quot;2015-11-26T22:43:20.24Z&quot;,
    &quot;ats&quot;: &quot;2015-11-26T21:05:21.239Z&quot;,
    &quot;content&quot;: &quot;&quot;,
    &quot;del&quot;: false,
    &quot;feed&quot;: &quot;http://www.instapaper.com/folder/1733843/rss/470308/Epogj3Ubs5DdJJnUdVD2HUAKSk&quot;,
    &quot;geek&quot;: false,
    &quot;id&quot;: &quot;5657741292d7e8a4ace10c5a&quot;,
    &quot;link&quot;: &quot;http://techcrunch.com/2014/07/07/mit-and-dropbox-alums-launch-inbox-a-next-generation-email-platform/&quot;,
    &quot;pic&quot;: &quot;&quot;,
    &quot;position&quot;: 6,
    &quot;snippet&quot;: &quot;Founded by Dropbox and MIT alums, a new startup called Inbox is launching out of stealth today, hoping to power the next generation of email applications.…&quot;,
    &quot;title&quot;: &quot;MIT And Dropbox Alums Launch Inbox, A Next-Generation Email Platform | TechCrunch&quot;,
    &quot;ts&quot;: &quot;2014-07-08T18:10:23Z&quot;,
    &quot;votes&quot;: 0
}
</code></pre><p>по поводу нескольких ts (тут их целых 3) могут быть резонные вопросы:</p><ol><li><code>activets</code> – момент активации новости</li><li><code>ts</code> – время новости из rss</li><li><code>ats</code> – когда новость добавлена в систему</li></ol><h4 id=что-у-нас-есть-сегодня-в-старой-системе>Что у нас есть сегодня в старой системе</h4><p><img src=/images/posts/1bi40-201511-26155228-uer60.png alt>
Вроде тут все понятно. А то, что вычеркнул – это не потому что секрет какой, но я просто не помню что это было, и точно этого не надо.</p><p><img src=/images/posts/nvynb-201511-26155730-edcut.png alt>
Тоже все просто.</p><p>Это все было для админов, вот что видят обычные пользователи:
<img src=/images/posts/q0dgn-201511-26155839-ywrtw.png alt></p><p>Вот вроде и все, что могу показать. Если надо еще деталей - спрашивайте в комментариях. И да, API доступен для ваших экспериментов на <a href=http://master.radio-t.com>http://master.radio-t.com</a>:8778. И CORS там пока работает, чтоб вы могли спокойно разрабатывать свою сторону.</p><p><strong>upd:</strong> по вашему совету сделал <a href=https://github.com/umputun/rtnews-ui>github repo</a>
<img src=/images/posts/csgg1-201511-27122159-3geii.png alt></p><p>Пара слов, чего я ожидаю в результате:</p><ol><li>Некоторые запросы (все, что не GET) будут доступны только админу (простая basic auth на стороне nginx будет требовать этого)</li><li>То, что видит нормальный пользователь (не админ) это список, и активную тему. Ну плюс всякие визуальные плюшки, типа снипета, картинки, открытие полного content.</li><li>Админ часто двигает темы вверх вниз, это должно быть просто и удобно. Сейчас там прелестно работает drag–drop. И да, часто делается &ldquo;подвинуть новость на самый вверх&rdquo;</li><li>Админ может ошибиться и удалить не то. Хорошо бы показать &ldquo;deleted&rdquo; и разрешить &ldquo;restore&rdquo; (я добавлю restore в API)</li><li>Для тем гиковского выпуска не надо ничего особенного для админа, только пометить/очистить флаг. Для view этого надо ссылку на ручное переключения на &ldquo;посмотреть только гиковские&rdquo;.</li></ol><p><em>5 Дек. 2015: <strong><a href=https://news.radio-t.com>новая версия уже тут!</a></strong> Спасибо всем неравнодушным, и конечно <a href=https://github.com/igoradamenko>Игорю Адаменко</a>, который придумал и реализовал весь этот UI. Всем, у кого остались замечательные идеи, рекомендую скооперироваться с автором нового фронтенда <a href=https://github.com/igoradamenko/rtnews-ui.git>на гитхабе</a>.</em></p></div><div id=remark42></div></article></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-20349923-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://use.fontawesome.com/releases/v5.11.2/js/all.js integrity=sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1 crossorigin=anonymous></script><script>var remark_config={host:"https://remark42.umputun.com",site_id:'p.umputun.com',components:['embed','counter'],locale:'ru'};(function(c){for(var i=0;i<c.length;i++){var d=document,s=d.createElement('script');s.src=remark_config.host+'/web/'+c[i]+'.js';s.defer=true;(d.head||d.body).appendChild(s);}})(remark_config.components||['embed']);</script></body></html>